"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(e,t){var i={},n,r,o=true,a=0,s=[],u=40,l="BugsnagNotify",c=10,d=5;i.breadcrumbLimit=20;i.noConflict=function(){e.Bugsnag=t;if(typeof t==="undefined"){delete e.Bugsnag}return i};i.refresh=function(){c=10};i.notifyException=function(e,t,n,r){if(!e){var o="Bugsnag.notifyException() was called with no arguments";A(o);i.notify(l,o);return}if(typeof e==="string"){A("Bugsnag.notifyException() was called with a string. Expected instance of Error. "+"To send a custom message instantiate a new Error or use Bugsnag.notify('<string>')."+" see https://docs.bugsnag.com/platforms/browsers/#reporting-handled-exceptions");i.notify.apply(null,arguments);return}if(t&&typeof t!=="string"){n=t;t=undefined}if(!n){n={}}C(n);G({name:t||e.name,message:e.message||e.description,stacktrace:J(e)||Q(),file:e.fileName||e.sourceURL,lineNumber:e.lineNumber||e.line,columnNumber:e.columnNumber?e.columnNumber+1:undefined,severity:r},n,{originalSeverity:"warning",unhandled:false,severityReason:{type:"handledException"}})};i.notify=function(t,i,n,r){if(!t){t=l;i="Bugsnag.notify() was called with no arguments";A(i)}G({name:t,message:i,stacktrace:Q(),file:e.location.toString(),lineNumber:1,severity:r},n,{originalSeverity:"warning",unhandled:false,severityReason:{type:"handledError"}})};i.leaveBreadcrumb=function(e,t){var n="manual";var r={type:n,name:"Manual",timestamp:(new Date).getTime()};switch(typeof e==="undefined"?"undefined":_typeof(e)){case"object":r=O(r,e);break;case"string":if(t&&(typeof t==="undefined"?"undefined":_typeof(t))==="object"){r=O(r,{name:e,metaData:t})}else{r.metaData={message:e}}break;default:A("expecting 1st argument to leaveBreadcrumb to be a 'string' or 'object', got "+(typeof e==="undefined"?"undefined":_typeof(e)));return}var o=[n,"error","log","navigation","process","request","state","user"];var a=false;for(var l=0;l<o.length;l++){if(o[l]===r.type){a=true;break}}if(!a){A("Converted invalid breadcrumb type '"+r.type+"' to '"+n+"'");r.type=n}var c=s.slice(-1)[0];if(f(r,c)){c.count=c.count||1;c.count++}else{var d=Math.min(i.breadcrumbLimit,u);r.name=x(r.name,32);s.push(I(r,140));if(s.length>d){s=s.slice(-d)}}};function f(e,t){return e&&t&&e.type===t.type&&e.name===t.name&&j(e.metaData,t.metaData)}function h(e){try{if(typeof e!=="function"){return e}if(!e.bugsnag){var t=_();e.bugsnag=function(){n=t;if(o){try{return e.apply(this,arguments)}catch(a){if(M("autoNotify",true)){var i={};C(i);G({name:a.name,message:a.message,stacktrace:J(a)||Q(),file:a.fileName||a.sourceURL,lineNumber:a.lineNumber||a.line,columnNumber:a.columnNumber?a.columnNumber+1:undefined},i,{originalSeverity:"error",unhandled:true,severityReason:{type:"unhandledException"}});z()}throw a}finally{n=null}}else{var r=e.apply(this,arguments);n=null;return r}};e.bugsnag.bugsnag=e.bugsnag}return e.bugsnag}catch(i){return e}}var p=typeof e.addEventListener!=="undefined";function v(){if(!p){return}var t=function n(e){if(!X("autoBreadcrumbsClicks")){return}var t,n;try{t=L(e.target);n=R(e.target)}catch(r){t="[hidden]";n="[hidden]";A("Cross domain error when tracking click event. See https://docs.bugsnag.com/platforms/browsers/faq/#3-cross-origin-script-errors")}i.leaveBreadcrumb({type:"user",name:"UI click",metaData:{targetText:t,targetSelector:n}})};e.addEventListener("click",t,true)}i.enableAutoBreadcrumbsConsole=function(){};i.disableAutoBreadcrumbsConsole=function(){};function g(){function t(e,t){if(!X("autoBreadcrumbsConsole")){return}i.leaveBreadcrumb({type:"log",name:"Console output",metaData:{severity:e,message:Array.prototype.slice.call(t).join(", ")}})}if(typeof e.console==="undefined"){return}var n=console.log,r=console.warn,o=console.error,a=console.group,s=console.groupCollapsed;i.enableAutoBreadcrumbsConsole=function(){i.autoBreadcrumbsConsole=true;N(console,"log",function(){t("log",arguments)});N(console,"warn",function(){t("warn",arguments)});N(console,"error",function(){t("error",arguments)});N(console,"group",function(){t("log",["[group]"].concat(Array.prototype.slice.call(arguments)))});N(console,"groupCollapsed",function(){t("log",["[group]"].concat(Array.prototype.slice.call(arguments)))})};i.disableAutoBreadcrumbsConsole=function(){i.autoBreadcrumbsConsole=false;console.log=n;console.warn=r;console.error=o;console.group=a;console.groupCollapsed=s};if(X("autoBreadcrumbsConsole")){i.enableAutoBreadcrumbsConsole()}}i.enableAutoBreadcrumbsNavigation=function(){};i.disableAutoBreadcrumbsNavigation=function(){};function m(){function t(e){return e.split("#")[1]||""}function n(e){var i=e.oldURL,n=e.newURL,r={};if(i&&n){r.from=t(i);r.to=t(n)}else{r.to=location.hash}return{type:"navigation",name:"Hash changed",metaData:r}}function r(){return{type:"navigation",name:"Navigated back"}}function o(){return{type:"navigation",name:"Page hidden"}}function a(){return{type:"navigation",name:"Page shown"}}function s(){return{type:"navigation",name:"Page loaded"}}function u(){return{type:"navigation",name:"DOMContentLoaded"}}function l(e,t,i,n){var r=location.pathname+location.search+location.hash;return{type:"navigation",name:"History "+e,metaData:{from:r,to:n||r,prevState:history.state,nextState:t}}}function c(e,t,i){return l("pushState",e,t,i)}function d(e,t,i){return l("replaceState",e,t,i)}function f(e){return function(){if(!X("autoBreadcrumbsNavigation")){return}i.leaveBreadcrumb(e.apply(null,arguments))}}if(!p||!e.history||!e.history.state||!e.history.pushState||!e.history.pushState.bind){return}var h=history.pushState,v=history.replaceState;i.enableAutoBreadcrumbsNavigation=function(){i.autoBreadcrumbsNavigation=true;N(history,"pushState",f(c));N(history,"replaceState",f(d))};i.disableAutoBreadcrumbsNavigation=function(){i.autoBreadcrumbsNavigation=false;history.pushState=h;history.replaceState=v};e.addEventListener("hashchange",f(n),true);e.addEventListener("popstate",f(r),true);e.addEventListener("pagehide",f(o),true);e.addEventListener("pageshow",f(a),true);e.addEventListener("load",f(s),true);e.addEventListener("DOMContentLoaded",f(u),true);if(X("autoBreadcrumbsNavigation")){i.enableAutoBreadcrumbsNavigation()}}i.enableAutoBreadcrumbsErrors=function(){i.autoBreadcrumbsErrors=true};i.disableAutoBreadcrumbsErrors=function(){i.autoBreadcrumbsErrors=false};i.enableAutoBreadcrumbsClicks=function(){i.autoBreadcrumbsClicks=true};i.disableAutoBreadcrumbsClicks=function(){i.autoBreadcrumbsClicks=false};i.enableAutoBreadcrumbs=function(){i.enableAutoBreadcrumbsClicks();i.enableAutoBreadcrumbsConsole();i.enableAutoBreadcrumbsErrors();i.enableAutoBreadcrumbsNavigation()};i.disableAutoBreadcrumbs=function(){i.disableAutoBreadcrumbsClicks();i.disableAutoBreadcrumbsConsole();i.disableAutoBreadcrumbsErrors();i.disableAutoBreadcrumbsNavigation()};i.enableNotifyUnhandledRejections=function(){i.notifyUnhandledRejections=true};i.disableNotifyUnhandledRejections=function(){i.notifyUnhandledRejections=false};var y=document.readyState!=="complete";function b(){y=false}if(document.addEventListener){document.addEventListener("DOMContentLoaded",b,true);e.addEventListener("load",b,true)}else{e.attachEvent("onload",b)}function _(){var e=document.currentScript||n;if(!e&&y){var t=document.scripts||document.getElementsByTagName("script");e=t[t.length-1]}return e}function C(e){var t=_();if(t){e.script={src:t.src,content:M("inlineScript",true)?t.innerHTML:""}}}var k=/^[0-9a-f]{32}$/i;var w=/function\s*([\w\-$]+)?\s*\(/i;var E="https://notify.bugsnag.com/";var U=E+"js";var S="3.3.0";var B=document.getElementsByTagName("script");var T=B[B.length-1];function N(e,t,i){var n=e[t];e[t]=function(){i.apply(this,arguments);if(typeof n==="function"){n.apply(this,arguments)}}}function A(t){var i=M("disableLog");var n=e.console;if(n!==undefined&&n.log!==undefined&&!i){n.log("[Bugsnag] "+t)}}function j(e,t){return V(e)===V(t)}function L(e){var t=e.textContent||e.innerText||"";if(e.type==="submit"||e.type==="button"){t=e.value}t=t.replace(/^\s+|\s+$/g,"");return x(t,140)}function R(e){var t=[e.tagName];if(e.id){t.push("#"+e.id)}if(e.className&&e.className.length){var i="."+e.className.split(" ").join(".");t.push(i)}var n=t.join("");if(!document.querySelectorAll||!Array.prototype.indexOf){return n}try{if(document.querySelectorAll(n).length===1){return n}}catch(o){return n}if(e.parentNode.childNodes.length>1){var r=Array.prototype.indexOf.call(e.parentNode.childNodes,e)+1;n=n+":nth-child("+r+")"}if(document.querySelectorAll(n).length===1){return n}if(e.parentNode){return R(e.parentNode)+" > "+n}return n}function x(e,t){var i="(...)";if(e&&e.length>t){return e.slice(0,t-i.length)+i}else{return e}}function D(e){return Object.prototype.toString.call(e)==="[object Array]"}function I(e,t,i){var n=(i||0)+1;var r=M("maxDepth",d);if(i>r){return"[RECURSIVE]"}if(typeof e==="string"){return x(e,t)}else if(D(e)){var o=[];for(var a=0;a<e.length;a++){o[a]=I(e[a],t,n)}return o}if((typeof e==="undefined"?"undefined":_typeof(e))==="object"&&e!=null){var s={};for(var u in e){if(e.hasOwnProperty(u)){s[u]=I(e[u],t,n)}}return s}else{return e}}function V(t,i,n){var r=M("maxDepth",d);if(n>=r){return encodeURIComponent(i)+"=[RECURSIVE]"}n=n+1||1;try{if(e.Node&&t instanceof e.Node){return encodeURIComponent(i)+"="+encodeURIComponent(W(t))}var o=[];for(var a in t){if((!t.hasOwnProperty||t.hasOwnProperty(a))&&a!=null&&t[a]!=null){var s=i?i+"["+a+"]":a,u=t[a];o.push((typeof u==="undefined"?"undefined":_typeof(u))==="object"?V(u,s,n):encodeURIComponent(s)+"="+encodeURIComponent(u))}}return o.sort().join("&")}catch(l){return encodeURIComponent(i)+"="+encodeURIComponent(""+l)}}i._serialize=V;function O(e,t,i){if(t==null){return e}else if(i>=M("maxDepth",d)){return"[RECURSIVE]"}e=e||{};for(var n in t){if(t.hasOwnProperty(n)){try{if(t[n].constructor===Object){e[n]=O(e[n],t[n],i+1||1)}else{e[n]=t[n]}}catch(r){e[n]=t[n]}}}return e}function F(e,t){e+="?"+V(t)+"&ct=img&cb="+(new Date).getTime();if(typeof BUGSNAG_TESTING!=="undefined"&&i.testRequest){i.testRequest(e,t)}else{var n=M("notifyHandler");if(n==="xhr"){var r=new XMLHttpRequest;r.open("GET",e,true);r.send()}else{var o=new Image;o.src=e}}}function H(e){var t={};var i=/^data\-([\w\-]+)$/;if(e){var n=e.attributes;for(var r=0;r<n.length;r++){var o=n[r];if(i.test(o.nodeName)){var a=o.nodeName.match(i)[1];t[a]=o.value||o.nodeValue}}}return t}var q;function M(e,t){q=q||H(T);var n=i[e]!==undefined?i[e]:q[e.toLowerCase()];if(n==="false"){n=false}if(e==="notifyReleaseStages"&&typeof n==="string"){n=n.split(/\s*,\s*/)}return n!==undefined?n:t}function P(e){if(!e||!e.match(k)){A("Invalid API key '"+e+"'");return false}return true}function X(e){var t=M("autoBreadcrumbs",true);return M(e,t)}function G(t,n,o){var a="fffa983114133b7ccc664d8e3d29cc0b";if(!P(a)||!c){return}c-=1;var u=M("releaseStage","production");var l=e.location.href;if(l.match(/amagllc.net/)){u="development"}else{u="production"}var d=M("notifyReleaseStages");if(d){var f=false;for(var h=0;h<d.length;h++){if(u===d[h]){f=true;break}}if(!f){return}}var p=[t.name,t.message,t.stacktrace].join("|");if(p===r){return}else{r=p}var v={device:{time:(new Date).getTime()}};var g={notifierVersion:S,apiKey:a,projectRoot:M("projectRoot")||e.location.protocol+"//"+e.location.host,context:M("context")||e.location.pathname,user:M("user"),metaData:O(O(v,M("metaData")),n),releaseStage:u,appVersion:M("appVersion"),url:e.location.href,userAgent:navigator.userAgent,language:navigator.language||navigator.userLanguage,severity:t.severity,name:t.name,message:t.message,stacktrace:t.stacktrace,file:t.file,lineNumber:t.lineNumber,columnNumber:t.columnNumber,breadcrumbs:s,payloadVersion:"3"};var m=t.severity;var y=m&&m!==o.originalSeverity;if(y){g.severity=new String(y);g.severity.__userSpecifiedSeverity=true}var b=i.beforeNotify;if(typeof b==="function"){var _=b(g,g.metaData);if(_===false){return}}var C=g.severity;var k=C&&!C.__userSpecifiedSeverity&&C!==o.originalSeverity;if(k){g.severity=C;g.severityReason={type:"userCallbackSetSeverity"}}else if(y){g.severity=m;g.severityReason={type:"userSpecifiedSeverity"}}else{g.severity=o.originalSeverity;g.severityReason=o.severityReason}g.unhandled=o.unhandled;if(g.lineNumber===0&&/Script error\.?/.test(g.message)){return A("Ignoring cross-domain or eval script error. See https://docs.bugsnag.com/platforms/browsers/faq/#3-cross-origin-script-errors")}F(M("endpoint")||U,g)}function Q(){var e,t;var i=10;var n="[anonymous]";try{throw new Error("")}catch(s){e="<generated>\n";t=J(s)}if(!t){e="<generated-ie>\n";var r=[];try{var o=arguments.callee.caller.caller;while(o&&r.length<i){var a=w.test(o.toString())?RegExp.$1||n:n;r.push(a);o=o.caller}}catch(u){A(u)}t=r.join("\n")}return e+t}function J(e){return e.stack||e.backtrace||e.stacktrace}function W(e){if(e){var t=e.attributes;if(t){var i="<"+e.nodeName.toLowerCase();for(var n=0;n<t.length;n++){if(t[n].value&&t[n].value.toString()!=="null"){i+=" "+t[n].name+'="'+t[n].value+'"'}}return i+">"}else{return e.nodeName}}}function z(){a+=1;e.setTimeout(function(){a-=1})}if(!e.atob){o=false}else if(e.ErrorEvent){try{if(new e.ErrorEvent("test").colno===0){o=false}}catch(Y){}}function $(t,i,n){var r=t[i];var o=n(r);t[i]=o;if(typeof BUGSNAG_TESTING!=="undefined"&&e.undo){e.undo.push(function(){t[i]=r})}}if(M("autoNotify",true)){$(e,"onerror",function(t){if(typeof BUGSNAG_TESTING!=="undefined"){i._onerror=t}return function r(o,s,u,l,c){var d=M("autoNotify",true);var f={};if(!l&&e.event){l=e.event.errorCharacter}C(f);n=null;if(d&&!a){var h,p;if(arguments.length===1){h=o&&o.type?"Event: "+o.type:"window.onerror";p=o&&o.detail?o.detail:undefined;f.event=o}else{h=c&&c.name||"window.onerror";p=o}G({name:h,message:p,file:s,lineNumber:u,columnNumber:l,stacktrace:c&&J(c)||Q()},f,{originalSeverity:"error",unhandled:true,severityReason:{type:"unhandledException"}});if(X("autoBreadcrumbsErrors")){i.leaveBreadcrumb({type:"error",name:h,metaData:{severity:"error",file:s,message:p,line:u}})}}if(typeof BUGSNAG_TESTING!=="undefined"){t=i._onerror}if(t){t(o,s,u,l,c)}}});var K=function Z(e){return function(t,i){if(typeof t==="function"){t=h(t);var n=Array.prototype.slice.call(arguments,2);return e(function(){t.apply(this,n)},i)}else{return e(t,i)}}};$(e,"setTimeout",K);$(e,"setInterval",K);if(e.requestAnimationFrame){$(e,"requestAnimationFrame",function(e){return function(t){return e(h(t))}})}if(e.setImmediate){$(e,"setImmediate",function(e){return function(){var t=Array.prototype.slice.call(arguments);t[0]=h(t[0]);return e.apply(this,t)}})}if("onunhandledrejection"in e){e.addEventListener("unhandledrejection",function(e){if(M("notifyUnhandledRejections",false)){var t=e.reason;var i={};C(i);if(t&&!t.message){i.promiseRejectionValue=t}G({name:t&&t.name?t.name:"UnhandledRejection",message:t&&t.message?t.message:"",stacktrace:J(t)||Q(),file:t.fileName||t.sourceURL,lineNumber:t.lineNumber||t.line,columnNumber:t.columnNumber?t.columnNumber+1:undefined},i,{originalSeverity:"error",unhandled:true,severityReason:{type:"unhandledPromiseRejection"}})}})}"EventTarget Window Node ApplicationCache AudioTrackList ChannelMergerNode CryptoOperation EventSource FileReader HTMLUnknownElement IDBDatabase IDBRequest IDBTransaction KeyOperation MediaController MessagePort ModalWindow Notification SVGElementInstance Screen TextTrack TextTrackCue TextTrackList WebSocket WebSocketWorker Worker XMLHttpRequest XMLHttpRequestEventTarget XMLHttpRequestUpload".replace(/\w+/g,function(t){var i=e[t]&&e[t].prototype;if(i&&i.hasOwnProperty&&i.hasOwnProperty("addEventListener")){$(i,"addEventListener",function(e){return function(t,i,n,r){try{if(i&&i.handleEvent){i.handleEvent=h(i.handleEvent)}}catch(o){A(o)}return e.call(this,t,h(i),n,r)}});$(i,"removeEventListener",function(e){return function(t,i,n,r){e.call(this,t,i,n,r);return e.call(this,t,h(i),n,r)}})}})}v();g();m();if(M("autoBreadcrumbs",true)){i.leaveBreadcrumb({type:"navigation",name:"Bugsnag Loaded"})}e.Bugsnag=i;if(typeof define==="function"&&define.amd){define([],function(){return i})}else if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&_typeof(module.exports)==="object"){module.exports=i}})(window,window.Bugsnag);"use strict";if(!Array.prototype.indexOf){Array.indexOf=function(e,t){for(var i=t||0,n=this.length;i<n;i++){if(this[i]===e){return i}}return-1}}if(!Function.prototype.bind){Function.prototype.bind=function(e){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var t=Array.prototype.slice.call(arguments,1),i=this,n=function o(){},r=function a(){return i.apply(this instanceof n?this:e,t.concat(Array.prototype.slice.call(arguments)))};if(this.prototype){n.prototype=this.prototype}r.prototype=new n;return r}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}if(!Object.prototype.isEmpty){Object.isEmpty=function(e){for(var t in e){if(e.hasOwnProperty(t)){return false}}return true}}if(!Object.prototype.assign){Object.assign=function(e,t){if(e===null){throw new TypeError("Cannot convert undefined or null to object")}var i=Object(e);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r!==null){for(var o in r){if(Object.prototype.hasOwnProperty.call(r,o)){i[o]=r[o]}}}}return i}}if(!Date.prototype.toISOString){(function(){function e(e){if(e<10){return"0"+e}return e}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+(this.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}})()}"use strict";function uuid(){var e="",t,i;for(t=0;t<32;t++){i=Math.random()*16|0;if(t==8||t==12||t==16||t==20){e+="-"}e+=(t==12?4:t==16?i&3|8:i).toString(16)}return e}"use strict";if(!window.murmurhash){var murmurhash=function e(t,i){var n,r,o,a,s,u,l,c,d,f;n=t.length&3;r=t.length-n;o=i;s=3432918353;l=461845907;f=0;while(f<r){d=t.charCodeAt(f)&255|(t.charCodeAt(++f)&255)<<8|(t.charCodeAt(++f)&255)<<16|(t.charCodeAt(++f)&255)<<24;++f;d=(d&65535)*s+(((d>>>16)*s&65535)<<16)&4294967295;d=d<<15|d>>>17;d=(d&65535)*l+(((d>>>16)*l&65535)<<16)&4294967295;o^=d;o=o<<13|o>>>19;a=(o&65535)*5+(((o>>>16)*5&65535)<<16)&4294967295;o=(a&65535)+27492+(((a>>>16)+58964&65535)<<16)}d=0;switch(n){case 3:d^=(t.charCodeAt(f+2)&255)<<16;case 2:d^=(t.charCodeAt(f+1)&255)<<8;case 1:d^=t.charCodeAt(f)&255;d=(d&65535)*s+(((d>>>16)*s&65535)<<16)&4294967295;d=d<<15|d>>>17;d=(d&65535)*l+(((d>>>16)*l&65535)<<16)&4294967295;o^=d}o^=t.length;o^=o>>>16;o=(o&65535)*2246822507+(((o>>>16)*2246822507&65535)<<16)&4294967295;o^=o>>>13;o=(o&65535)*3266489909+(((o>>>16)*3266489909&65535)<<16)&4294967295;o^=o>>>16;return o>>>0}}"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var HeirialClientLogger=function(){function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,e);this._namespace=String(t)+" - ";this._debug=!!i.debug;return this._getLoggingMethod()}e.prototype._getLoggingMethod=function t(){var e=this._namespace;if(!this._debug)return function(){};if(window.console&&console.log.bind)return console.log.bind(console,e);return function(){var t=[e];for(var i=0;i<arguments.length;i++){if(_typeof(arguments[i])==="object"){t.push("\n"+JSON.stringify(arguments[i],null,"\t"))}else{t.push(arguments[i])}}alert(t.join(" "))}};return e}();"use strict";function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var HeirialAjaxInterface=function(){function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,e);this._allowBeacons=i.allowBeacons;this._intakeURL=String(t);this._timeout=parseInt(i.ajaxTimeout)||null;this._log=new HeirialClientLogger("HeirialAjaxInterface",i);return this._getSendingMethod()}e.prototype._getSendingMethod=function t(){if(location.protocol!=="http:"&&location.protocol!=="https:"){this._log("Error: The Heirial Client must be served over HTTP(S)")}else if(this._allowBeacons&&navigator.sendBeacon){return this._sendBeacon.bind(this)}else if("withCredentials"in new XMLHttpRequest){return this._sendXHR.bind(this)}else if(typeof XDomainRequest!=="undefined"){return this._sendXDR.bind(this)}else{this._log("This browser does not support AJAX")}return function(){}};e.prototype._sendBeacon=function i(e,t){var i=navigator.sendBeacon(this._intakeURL+"/"+e,JSON.stringify(t));if(!i)return this._log("The browser failed to queue the AJAX beacon");this._log("AJAX beacon sent")};e.prototype._sendXHR=function n(e,t){var i=this;var n=new XMLHttpRequest;n.open("post",this._intakeURL+"/"+e,true);n.setRequestHeader("Content-type","application/json");n.setRequestHeader("charset","utf-8");if(this._timeout!==null){n.timeout=this._timeout;n.ontimeout=function(){i._ajaxResponse(504,"Request timed out")}}n.onreadystatechange=function(){if(n.readyState===4&&n.status>0&&n.responseText){i._ajaxResponse(n.status,n.responseText)}};n.send(JSON.stringify(t))};e.prototype._sendXDR=function r(e,t){var i=this;var n=new XDomainRequest;n.onload=function(){i._ajaxResponse(200,n.responseText)};n.onerror=function(){i._ajaxResponse(400,n.responseText)};n.ontimeout=function(){i._ajaxResponse(504,"Request timed out")};if(this._timeout!==null){n.timeout=this._timeout}n.onprogress=function(){};n.open("post",this._intakeURL+"/"+e,true);setTimeout(function(){n.send(JSON.stringify(t))},0)};e.prototype._ajaxResponse=function o(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";if(t!==""){this._log("Response ["+e+"]: "+t)}};return e}();"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var HeirialClient=function(){function e(){_classCallCheck(this,e);this._performanceTracker("heirial initialized");this.version="2.0.0";this.config=Object.assign.apply(Object,[{ajaxTimeout:null,debug:false,events:[{selectors:"a, button",name:"click",tag:"ClickEvent"}],fingerprinter:{execute:this._defaultFingerprinter},refresh:false,stage:"live",tabPersistenceTimeout:750,useBeacons:true}].concat(Array.prototype.slice.call(arguments)));this.stateFields=["heirial2.uid","heirial2.vid","heirial2.lid"];this.stateFieldSeparator="::";this._log=new HeirialClientLogger("HeirialClient",this.config);this._send=function(){};this.currentUrl=window.location.href;this.loadEventData={referrer:document.referrer};this.loadEventUid=uuid();this._setCookie("heirial2.lid",this.loadEventUid);this.eventQueue=[];this.loadEventFired=false;this.newVisitTimer=false;this.visitUid=this._getCookie("heirial2.vid");this._setCookie("heirial2.vid",this.visitUid);this.visitorUid=this._getCookie("heirial2.uid");window.Bugsnag.leaveBreadcrumb("Constructor finished",{cookieUid:this._getCookie("heirial2.uid"),cookieVid:this._getCookie("heirial2.vid"),cookieLid:this._getCookie("heirial2.lid"),cookieFull:this._getCookie("heirial2"),objectUid:this.visitorUid,objectVid:this.visitUid,objectLid:this.loadEventUid,objectFull:this.visitorUid+"::"+this.visitUid+"::"+this.loadEventUid});this._init()}e.prototype.fire=function t(e){var t=this._getCookie("heirial2.uid")||this.visitorUid;var i=this._getCookie("heirial2.vid")||this.visitUid;var n=this.loadEventUid;var r=void 0,o=void 0;if(this._canFire(e)!==true){return}if(e==="LoadEvent"){r=n;o="intake/load"}else{if(e==="UnloadEvent"){r=i}else{r=uuid()}o="intake/page"}var a={uid:r,load_uid:e==="LoadEvent"?"0":this.loadEventUid,state:t+"::"+i+"::"+n,data:this._fireData.apply(this,arguments),timestamp:(new Date).toISOString(),event_tag:e};if(e!=="LoadEvent"&&!this.loadEventFired){this._log("New "+e+" queued");return this.eventQueue.push({endpoint:o,eventData:a})}window.Bugsnag.leaveBreadcrumb("Firing event",{cookieUid:this._getCookie("heirial2.uid"),cookieVid:this._getCookie("heirial2.vid"),cookieLid:this._getCookie("heirial2.lid"),cookieFull:this._getCookie("heirial2"),objectUid:this.visitorUid,objectVid:this.visitUid,objectLid:this.loadEventUid,objectFull:this.visitorUid+"::"+this.visitUid+"::"+this.loadEventUid});if(!this._getCookie("heirial2.uid")||!this._getCookie("heirial2.vid")||!this._getCookie("heirial2.lid")){var s=0;var u=100/s}this._send(o,a);this._log("New "+e,a)};e.prototype.attach=function i(e,t,n,r){if(typeof e!=="string"||typeof t!=="string"||typeof n!=="string"){return this._log("All arguments to .attach() must be strings")}var o=document.querySelectorAll(e);var a={callbacks:[],name:t,selectors:e};for(var s=0,u=o.length;s<u;s++){var l=this.fire.bind(this,n,o[s],r);a.callbacks.push(l);this._listen(o[s],t,l)}return a};e.prototype.detach=function n(e){if(!e){return null}if(!e.selectors||!e.name||!e.callbacks||typeof e.selectors!=="string"||typeof e.name!=="string"||e.callbacks.constructor!==Array){return this._log("Bad reference passed to .detach()")}else if(!e.callbacks.length){this._log("This reference has no bound callbacks");return e}var t=document.querySelectorAll(e.selectors);for(var i=0,n=t.length;i<n;i++){if(document.removeEventListener){t[i].removeEventListener(e.name,e.callbacks.shift())}else{t[i].detachEvent("on"+e.name,e.callbacks.shift())}}return e};e.prototype._getIntakeUrl=function r(){if(this.config.stage==="live"){return"https://api.heirial.com/v"+this.version[0]}if(this.config.stage==="staging"){return"https://api.heirial.com/staging"}return this.config.stage};e.prototype._init=function o(){if(!navigator.cookieEnabled){return this._log("Cookies are disabled");window.Bugsnag.leaveBreadcrumb("Cookies disabled...")}if(document.readyState!=="loading"){this._load()}else{this._listen(window,"load",this._load.bind(this))}};e.prototype._listen=function a(e,t,i){window.Bugsnag.leaveBreadcrumb("Adding event listener for "+t);if(document.addEventListener){e.addEventListener(t,i)}else{e.attachEvent("on"+t,i)}};e.prototype._syncTabVisits=function s(e){if(!e){e=window.event}if(!e.newValue){return}if(e.key==="requestVisitUID"){this._log("Another tab requested the visit UID");if(this.visitUid===null){this._log("Aborted sending empty visit UID")}else{localStorage.setItem("sendVisitUID",this.visitUid);localStorage.removeItem("sendVisitUID")}}else if(e.key==="sendVisitUID"&&this.visitUid===null){if(this.newVisitTimer){this._log("Another tab sent the visit UID");this.visitUid=e.newValue;this._setCookie("heirial2.vid",this.visitUid);clearTimeout(this.newVisitTimer);this._fireLoadEvent()}}};e.prototype._load=function u(){this._send=new HeirialAjaxInterface(this._getIntakeUrl(),this.config);this._normalizeVisitor();this._bindEvents();this._getVisitUID();var e=this._getCookie("heirial2.uid")||this.visitorUid;var t=this._getCookie("heirial2.vid")||this.visitUid;var i=this.loadEventUid;this.state=e+"::"+t+"::"+i;if(document.createEventObject){var n=document.createEventObject();return document.fireEvent("onheirial2:done",n)}else{var r=document.createEvent("HTMLEvents");r.initEvent("heirial2:done",true,true);return!document.dispatchEvent(r)}};e.prototype._normalizeVisitor=function l(){var e=this._getCookie("heirial2.ver")||"1.0.0";var t=this._getCookie("heirial.uid");var i=this._getCookie("heirial2.uid");if(!t&&!i){i=uuid();this._log('New visitor "'+i+'"')}else if(this.config.refresh||!i||e!==this.version){if(i){t=i}i=uuid();this._migrateVisitor(e,t,i)}this.visitorUid=i;this._setCookie("heirial2.uid",i);this._setCookie("heirial2.ver",this.version)};e.prototype._getCookie=function c(e){var t=this.stateFields.indexOf(e);var i=void 0;if(t>-1||e==="heirial2.*"){i=document.cookie.match(new RegExp("heirial2=([^\\s;]*)"));if(!e||!i){return["","",""]}if(e==="heirial2.*"){return unescape(i[1]).split(this.stateFieldSeparator)}return unescape(i[1]).split(this.stateFieldSeparator)[t]||""}i=document.cookie.match(new RegExp(e+"=([^\\s;]*)"));return e&&i?unescape(i[1]):""};e.prototype._setCookie=function d(e,t){window.Bugsnag.leaveBreadcrumb("Pre-cookie update: "+e,{cookieUid:this._getCookie("heirial2.uid"),cookieVid:this._getCookie("heirial2.vid"),cookieLid:this._getCookie("heirial2.lid"),cookieFull:this._getCookie("heirial2"),objectUid:this.visitorUid,objectVid:this.visitUid,objectLid:this.loadEventUid,objectFull:this.visitorUid+"::"+this.visitUid+"::"+this.loadEventUid});if(e==="heirial2.vid"){var i=navigator.userAgent.indexOf("MSIE")!=-1;if(!i){document.cookie="heirial2.vid="+t+"; expires=0; path=/"}else{document.cookie="heirial2.vid="+t+"; path=/"}var n=this.stateFields.indexOf(e);if(n>-1){var r=this._getCookie("heirial2.*");r[n]=t;document.cookie="heirial2="+r.join(this.stateFieldSeparator)+"; expires=Tue, 19 Jan 2038 03:14:07 UTC; path=/"}}else{var o=this.stateFields.indexOf(e);if(o>-1){var a=this._getCookie("heirial2.*");a[o]=t;document.cookie="heirial2="+a.join(this.stateFieldSeparator)+"; expires=Tue, 19 Jan 2038 03:14:07 UTC; path=/"}document.cookie=e+"="+t+"; expires=Tue, 19 Jan 2038 03:14:07 UTC; path=/"}window.Bugsnag.leaveBreadcrumb("Post-cookie update: "+e,{cookieUid:this._getCookie("heirial2.uid"),cookieVid:this._getCookie("heirial2.vid"),cookieLid:this._getCookie("heirial2.lid"),cookieFull:this._getCookie("heirial2"),objectUid:this.visitorUid,objectVid:this.visitUid,objectLid:this.loadEventUid,objectFull:this.visitorUid+"::"+this.visitUid+"::"+this.loadEventUid})};e.prototype._migrateVisitor=function f(e,t,i){var n=this.config.refresh?"Manual":"Automatic";this._send("map",{data:{current_url:this.currentUrl},reason:n+" migration from "+e+" to "+this.version,uid_1:t,uid_2:i});this._log("Visitor "+t+" migrated to "+i)};e.prototype._parseDomain=function h(){var e=this._parseHost(window.location.href).split(".");while(e.length>2){e.shift()}return e.join(".")};e.prototype._parseHost=function p(e){return e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0]};e.prototype._getVisitUID=function v(){this._getVisitUIDWithoutTabs()};e.prototype._getVisitUIDWithoutTabs=function g(){if(!this.config.refresh&&this.visitUid&&!this._isNewVisit()){this._fireLoadEvent()}else{this.visitUid=uuid();this._setCookie("heirial2.vid",this.visitUid);this._fireLoadEvent()}};e.prototype._getVisitUIDWithTabs=function m(){var e=this;if(!this.config.refresh&&this.visitUid){this._fireLoadEvent()}else{localStorage.setItem("requestVisitUID",1);localStorage.removeItem("requestVisitUID");this.newVisitTimer=setTimeout(function(){if(e._isNewVisit()){e.visitUid=uuid();e._setCookie("heirial2.vid",e.visitUid);e._log('New visit "'+e.visitUID+'"');e.newVisitTimer=false;return e._loadFingerprinter()}e._fireLoadEvent()},this.config.tabPersistenceTimeout)}};e.prototype._fireLoadEvent=function y(){this._performanceTracker("heirial fire load event called");var e=this._normalizeQueryVars();var t=this._getCookie("heirial2.vid")||this.visitUid;if(!Object.isEmpty(e)){this.loadEventData.get_vars=e}this.fire("LoadEvent",this.loadEventData);this.loadEventFired=true;while(this.eventQueue.length){var i=this.eventQueue.shift();i.eventData.visit_uid=t;this._log("Queued "+i.eventData.event_tag,i.eventData);this._send(i.endpoint,i.eventData)}};e.prototype._normalizeQueryVars=function b(){return Object.assign({},this._parseQueryVars(this.loadEventData.referrer),this._parseQueryVars(this.currentUrl))};e.prototype._parseQueryVars=function _(e){var t=this._parseQueryString(e);var i=t.split("&");var n={};for(var r=0,o=i.length;r<o;r++){var a=i[r].split("=");var s=decodeURIComponent(a[0]);a.shift();var u=a.join("=")||"true";if(s in n){if(!(n[s]instanceof Array)){n[s]=[n[s]]}n[s].push(decodeURIComponent(u))}else if(s!==""){n[s]=decodeURIComponent(u)}}return n};e.prototype._parseQueryString=function C(e){var t=e.indexOf("?");if(t<0){return""}var i=e.substring(t+1);if(i.indexOf("#")>-1){i=i.split("#")[0]}return i};e.prototype._bindEvents=function k(){for(var e=0;e<this.config.events.length;e++){var t=this.config.events[e];this.config.events[e].ref=this.attach(t.selectors,t.name,t.tag)}this._listen(window,"beforeunload",this._unload.bind(this))};e.prototype._unload=function w(){for(var e=0;e<this.config.events.length;e++){this.detach(this.config.events[e].ref)}clearTimeout(this.newVisitTimer);this.fire("UnloadEvent")};e.prototype._isNewVisit=function E(){if(this.config.refresh||!this._getCookie("heirial2.vid")||this._parseHost(this.currentUrl)!==this._parseHost(this.loadEventData.referrer)){return true}return false};e.prototype._loadFingerprinter=function U(){if(typeof this.config.fingerprinter.execute==="function"){if(typeof this.config.fingerprinter.script==="string"){return this._loadAsync(this.config.fingerprinter.script,this._executeFingerprinter.bind(this))}else if(!this.config.fingerprinter.script){return this._executeFingerprinter()}}this._log("The fingerprinter is invalid");this._fireLoadEvent()};e.prototype._loadAsync=function S(e,t){var i=document.createElement("script");i.type="text/javascript";i.async=true;i.src=e;if(i.readyState){i.onreadystatechange=function(){if(i.readyState==="loaded"||i.readyState==="complete"){i.onreadystatechange=null;t()}}}else{this._listen(i,"load",t)}document.body.insertBefore(i,null)};e.prototype._executeFingerprinter=function B(){var e="",t=void 0;try{t=this.config.fingerprinter.execute()||{}}catch(n){this._log("Fingerprinter error: "+n);return this._fireLoadEvent()}if(Object.isEmpty(t)){this._log("The fingerprinter returned an empty hash")}else{delete t.id;for(var i in t){if(typeof t[i]==="string"){e+=t[i]}else{e+=JSON.stringify(t[i])}}this.loadEventData.fingerprint=Object.assign({},t,{id:murmurhash(e,256)})}this._fireLoadEvent()};e.prototype._defaultFingerprinter=function T(){return{user_agent:navigator.userAgent}};e.prototype._canFire=function N(e){if(!navigator.cookieEnabled){return this._log("Cookies are disabled")}if(e==="LoadEvent"&&this.loadEventFired){return this._log("A LoadEvent has already been fired")}return true};e.prototype._fireData=function A(){var e={current_url:this.currentUrl};if(arguments.length<2||!arguments[1]){return e}if(arguments[1].nodeType&&arguments[1].nodeType===1){var t=this._elementData(arguments[1]);return Object.assign({element:t},arguments[2]||{},e)}else if(_typeof(arguments[1])!=="object"){this._log("The second fire argument is invalid");return e}return Object.assign(arguments[1],e)};e.prototype._elementData=function j(e){var t={};for(var i=0,n=e.attributes.length;i<n;i++){t[e.attributes[i].name]=e.attributes[i].value}return{attributes:t,text:e.innerHTML.replace(/(<([^>]+)>)/gi,"").trim(),html:e.outerHTML}};e.prototype._performanceTracker=function L(e){var t=new Date};return e}();if(!window.heirial2){window.heirial2=new HeirialClient(window.heirialConfig)}